<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bansi's World</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Tone.js for interactive music -->
  <script src="https://cdn.jsdelivr.net/npm/tone@14.7.58/build/Tone.js"></script>
  <style>
    /*
      ============================
      GLOBAL & LAYOUT STYLES
      ============================
    */
    body {
      cursor: url('https://cdn-icons-png.flaticon.com/512/2589/2589175.png') 16 16, auto;
      background-color: #fce9f0;
      overflow-x: hidden;
      font-family: 'Inter', sans-serif;
    }

    /* Pink heart cursor */
    body {
      cursor: url('https://www.flaticon.com/free-icon/pink-heart_1082697.png') 16 16, auto;
    }

    /* Floating hearts animation */
    .heart {
      position: fixed;
      bottom: -20px;
      font-size: 24px;
      animation: floatUp 6s linear infinite;
      opacity: 0.9;
      pointer-events: none;
      z-index: 1000;
    }
    @keyframes floatUp {
      0% { transform: translateY(0) scale(1); opacity: 0.9; }
      100% { transform: translateY(-120vh) scale(1.6); opacity: 0; }
    }

    /* Smooth page transitions */
    .hidden { display: none; }
    .fade-in { animation: fadeIn 0.8s ease-in-out; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /*
      ============================
      CONFETTI & PARTICLE EFFECTS
      ============================
    */
    .confetti {
      position: absolute;
      background-color: #fce9f0;
      animation: confetti-fall 2.5s linear forwards;
      z-index: 999;
    }

    /* More realistic confetti fall with randomness */
    @keyframes confetti-fall {
        0% { transform: translateY(0) rotate(0deg); opacity: 1; }
        100% { transform: translateY(100vh) translateX(var(--x-end, 0)) rotate(var(--rotation-end, 720deg)); opacity: 0; }
    }

    /* Heart confetti has its own style */
    .confetti-heart {
        font-size: 24px;
        animation: confetti-fall 2.5s linear forwards;
    }

    /*
      ============================
      CUSTOM UI/UX STYLES
      ============================
    */
    .glowing-heart {
        font-size: 8rem;
        cursor: pointer;
        animation: pulse 1.5s infinite cubic-bezier(0.68, -0.55, 0.27, 1.55);
        color: #ff69b4;
        transition: transform 0.2s ease-in-out;
    }
    .glowing-heart:hover {
        transform: scale(1.1);
    }
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }

    .revealed-button {
        opacity: 0;
        animation: pop-in 0.5s forwards cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    @keyframes pop-in {
        from { opacity: 0; transform: scale(0.8); }
        to { opacity: 1; transform: scale(1); }
    }

    #love-reason-display {
      transition: all 0.5s ease-in-out;
      animation: fade-in-out 0.5s ease-in-out;
    }
    @keyframes fade-in-out {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .timeline-event {
        position: relative;
        padding-left: 20px;
        margin-bottom: 30px;
        border-left: 2px solid #ff69b4;
    }

    .timeline-event::before {
        content: '';
        position: absolute;
        left: -8px;
        top: 0;
        width: 14px;
        height: 14px;
        background-color: #ff69b4;
        border-radius: 50%;
        border: 2px solid #fff;
    }
  </style>
</head>
<body class="relative flex items-center justify-center min-h-screen p-4">

  <!-- Landing Page -->
  <div id="landing" class="w-full max-w-sm bg-white rounded-3xl shadow-xl overflow-hidden border-4 border-pink-400 z-10 text-center">
    <!-- Heart-filled banner with a cute pattern -->
    <div class="bg-pink-300 h-40 flex items-center justify-center relative">
      <div class="absolute inset-0 z-0">
        <svg width="100%" height="100%">
          <defs>
            <pattern id="heart-pattern" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse">
              <path d="M10 2.5a.5.5 0 01.5.5v.5h-1v-.5a.5.5 0 01.5-.5zM7 5a.5.5 0 01.5-.5h1v1h-1a.5.5 0 01-.5-.5zM13 5a.5.5 0 01.5-.5h1v1h-1a.5.5 0 01-.5-.5z" fill="#fbcfe8"/>
            </pattern>
          </defs>
          <rect width="100%" height="100%" fill="url(#heart-pattern)"/>
        </svg>
      </div>
      <h1 class="text-4xl font-extrabold text-white relative z-10">Bansi's World</h1>
    </div>
    
    <div class="p-6">
      <p class="text-gray-700 mb-4">A special place made just for you.</p>
      <button onclick="goToWorld()" class="bg-pink-400 hover:bg-pink-500 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-transform transform hover:scale-105">
        Let's Go! üíñ
      </button>
    </div>
  </div>

  <!-- Bansi's World Page (Container for all activities) -->
  <div id="world" class="hidden fade-in w-full max-w-3xl bg-white rounded-3xl shadow-xl border-4 border-pink-400 z-10 p-6">
    <h1 class="text-3xl font-extrabold text-pink-600 mb-2">Welcome, My Love! üíï</h1>
    <p class="text-gray-700 mb-6">Hello miss bansi bangera. This pinkass hello kitty stuff is for you just in case you ever miss me lmao so have fun. I hope it brings a smile to your face bbg, my kuchupuchu. ALSO HAPPY BIRTHDAY TO YOUUUUUUUUUUUUUUUU</p>
    
    <!-- Activity Selector Buttons -->
    <div id="activity-buttons-container" class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-8">
      <button onclick="showActivity('diary')" class="w-full bg-pink-400 hover:bg-pink-500 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-transform transform hover:scale-105">
        Our Diary üìù
      </button>
      <a href="memories.html" class="block w-full text-center bg-pink-400 hover:bg-pink-500 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-transform transform hover:scale-105">
        Our Memories üì∏
      </a>
      <button onclick="showActivity('love-reasons')" class="w-full bg-pink-400 hover:bg-pink-500 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-transform transform hover:scale-105">
        Why I Love You ‚ù§Ô∏è
      </button>
      <button onclick="showActivity('guess-game')" class="w-full bg-pink-400 hover:bg-pink-500 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-transform transform hover:scale-105">
        Play a Game üéÆ
      </button>
      <button onclick="showActivity('wishes')" class="w-full bg-pink-400 hover:bg-pink-500 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-transform transform hover:scale-105">
        Wishes ü•≥
      </button>
    </div>

    <!-- Why I Love You Section -->
    <div id="love-reasons-activity" class="activity-section hidden text-center">
      <h2 class="text-2xl font-bold text-pink-500 mb-4">Why I Love You</h2>
      <div id="love-reason-display" class="bg-pink-100 text-pink-700 p-6 rounded-2xl border border-pink-200 min-h-[100px] flex items-center justify-center italic text-lg mb-6 shadow-inner transition-all duration-500 ease-in-out">
        Tap the button to reveal a reason...
      </div>
      <button onclick="generateLoveReason()" class="bg-pink-400 hover:bg-pink-500 text-white font-bold py-2 px-4 rounded-full shadow transition-transform transform hover:scale-105">
        Reveal
      </button>
    </div>

    <!-- Diary Section -->
    <div id="diary-activity" class="activity-section hidden">
      <h2 class="text-2xl font-bold text-pink-500 mb-4 text-center">Here's a Pink Virtual Diary</h2>
      <p class="text-gray-700 text-center mb-4">Write down a happy memory of us and save it forever!</p>
      <textarea id="diary-input" class="w-full p-4 rounded-xl border border-pink-300 focus:outline-none focus:ring-2 focus:ring-pink-400 mb-4 shadow-inner" rows="4" placeholder="What's a memory you cherish?"></textarea>
      <div class="flex justify-center mb-6">
        <button onclick="saveDiaryEntry()" class="bg-pink-400 hover:bg-pink-500 text-white font-bold py-2 px-4 rounded-full shadow transition-transform transform hover:scale-105">
          Save Entry ‚ú®
        </button>
      </div>
      <div id="diary-list" class="space-y-3 p-4 bg-pink-50 rounded-xl border border-pink-200">
        <h3 class="text-lg font-semibold text-pink-600 mb-2">Our Special Moments:</h3>
        <!-- Diary entries will be appended here by JavaScript -->
      </div>
    </div>

    <!-- Guessing Game Section -->
    <div id="guess-game-activity" class="activity-section hidden text-center">
        <h2 class="text-2xl font-bold text-pink-500 mb-4">Guess the Number!</h2>
        <p class="text-gray-700 mb-4">I'm thinking of the most perfect number in the world. Can you guess it?</p>
        <input type="number" id="guess-input" class="w-40 p-3 rounded-xl border border-pink-300 focus:outline-none focus:ring-2 focus:ring-pink-400 text-center mb-4" placeholder="Enter guess" min="1" max="10">
        <button onclick="checkGuess()" class="bg-pink-400 hover:bg-pink-500 text-white font-bold py-2 px-4 rounded-full shadow transition-transform transform hover:scale-105">
            Check
        </button>
        <div id="guess-message" class="mt-4 text-lg font-semibold text-pink-600"></div>
    </div>

    <!-- Wishes Section -->
    <div id="wishes-activity" class="activity-section hidden text-center">
      <h2 class="text-2xl font-bold text-pink-500 mb-4">Birthday Wishes</h2>
      <p class="text-gray-700 mb-6">A very special message from all of us who love you! ‚ù§Ô∏è</p>
      <div id="wishes-player-container" class="w-full max-w-xl mx-auto bg-pink-100 p-2 rounded-xl shadow-lg border border-pink-200 text-center space-y-4">
        <!-- === VIDEO FIX: Replaced placeholder with your actual videos === -->
        <div>
          <h3 class="text-lg font-semibold text-pink-600">Misti's Wish</h3>
          <video class="w-full rounded-lg" controls>
            <source src="videos/misti.mp4" type="video/mp4">
            Your browser does not support the video tag.
          </video>
        </div>
        <div>
          <h3 class="text-lg font-semibold text-pink-600">Tanisha's Wish</h3>
          <video class="w-full rounded-lg" controls>
            <source src="videos/tanisha.mp4" type="video/mp4">
            Your browser does not support the video tag.
          </video>
        </div>
      </div>
    </div>
    
    <!-- Our Story Timeline Section -->
    <div id="timeline-activity" class="activity-section hidden">
        <h2 class="text-2xl font-bold text-pink-500 mb-4 text-center">Our Beautiful Story</h2>
        <div id="timeline-container" class="relative max-w-2xl mx-auto p-4 bg-pink-50 rounded-xl border border-pink-200">
            <div id="timeline-content" class="space-y-8">
                <div class="timeline-event">
                    <p class="text-sm text-gray-500">October 18, 2024</p>
                    <p class="text-gray-700 font-semibold">The day you were born and came into my life!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Go Back Button -->
    <div class="mt-8 flex justify-center">
      <button onclick="goBack()" class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-full shadow transition-transform transform hover:scale-105">
        Go Back
      </button>
    </div>

  </div>

  <!-- Floating hearts and general non-module script -->
  <script>
    /*
      ============================
      GENERAL UTILITIES & ANIMATIONS
      ============================
    */
    const floatingHearts = ["üíñ", "‚ù§Ô∏è", "üíú", "üíô", "üß°", "üíõ"];
    function createFloatingHeart() {
      const heart = document.createElement("div");
      heart.classList.add("heart");
      heart.innerHTML = floatingHearts[Math.floor(Math.random() * floatingHearts.length)];
      heart.style.left = Math.random() * 100 + "vw";
      heart.style.fontSize = (20 + Math.random() * 20) + "px";
      heart.style.animationDuration = (3 + Math.random() * 4) + "s";
      document.body.appendChild(heart);
      setTimeout(() => heart.remove(), 7000);
    }
    setInterval(createFloatingHeart, 600);

    /*
      ============================
      PAGE NAVIGATION
      ============================
    */
    function goToWorld() {
      document.getElementById("landing").classList.add("hidden");
      const world = document.getElementById("world");
      world.classList.remove("hidden");
      world.classList.add("fade-in");
    }

    function goBack() {
      document.querySelectorAll('.activity-section').forEach(section => {
        section.classList.add('hidden');
      });
      document.getElementById('activity-buttons-container').classList.remove('hidden');
    }
    
    function showActivity(activityId) {
      document.querySelectorAll('.activity-section').forEach(section => {
        section.classList.add('hidden');
      });
      document.getElementById(activityId + '-activity').classList.remove('hidden');
    }

    /*
      ============================
      WHY I LOVE YOU REASONS
      ============================
    */
    const loveReasons = [
        "Your laugh is my favorite sound.", "The way you look at me.", "Your incredible kindness.",
        "You make me feel safe.", "Your inner and outer beauty.", "The way you care for others.",
        "Your brilliant mind.", "You always believe in me.", "You challenge me to be better.",
        "Your strength and resilience.", "Just being with you feels like home.", "You are my biggest supporter.",
        "Every day is an adventure with you.", "You are the absolute best.", "I love your gentle soul.",
        "You inspire me every single day.", "Your passion for life.", "The way you see the world.",
        "Your ability to make me smile.", "You're a gift to everyone around you."
    ];
    let reasonQueue = [];
    function shuffleReasons() {
        for (let i = loveReasons.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [loveReasons[i], loveReasons[j]] = [loveReasons[j], loveReasons[i]];
        }
    }
    shuffleReasons();
    function generateLoveReason() {
        const display = document.getElementById("love-reason-display");
        if (reasonQueue.length === 0) {
            reasonQueue = [...loveReasons];
        }
        const nextReason = reasonQueue.pop();
        display.textContent = nextReason;
        playChimeSound();
    }
    
    /*
      ============================
      GUESSING GAME
      ============================
    */
    const secretNumber = 10;
    function createConfetti() {
        const confettiCount = 1000;
        const colors = ['#fce9f0', '#ffb6c1', '#ff69b4', '#ff1493', '#c71585', '#ffe4e1'];
        const shapes = ['square', 'circle', 'heart'];

        for (let i = 0; i < confettiCount; i++) {
            const confetti = document.createElement('div');
            const shape = shapes[Math.floor(Math.random() * shapes.length)];
            confetti.classList.add('confetti');
            const xStart = Math.random() * 100;
            const xEnd = xStart + (Math.random() - 0.5) * 40;
            const rotationEnd = Math.random() * 1080 + 720;
            confetti.style.setProperty('--x-end', `${xEnd}vw`);
            confetti.style.setProperty('--rotation-end', `${rotationEnd}deg`);
            confetti.style.left = `${xStart}vw`;
            confetti.style.top = `${-20 - Math.random() * 10}px`;
            if (shape === 'heart') {
                confetti.innerHTML = 'üíñ';
                confetti.style.fontSize = (Math.random() * 16 + 12) + 'px';
            } else {
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.width = (Math.random() * 8 + 4) + 'px';
                confetti.style.height = confetti.style.width;
            }
            confetti.style.animationDuration = (Math.random() * 2 + 2.5) + 's';
            confetti.style.animationDelay = (Math.random() * 0.5) + 's';
            document.body.appendChild(confetti);
            setTimeout(() => confetti.remove(), 4000);
        }
    }

    function checkGuess() {
        const guessInput = document.getElementById('guess-input');
        const guess = parseInt(guessInput.value);
        const messageEl = document.getElementById('guess-message');
        
        if (isNaN(guess) || guess < 1 || guess > 10) {
            messageEl.textContent = "Please enter a valid number between 1 and 10.";
            return;
        }

        if (guess === secretNumber) {
            messageEl.textContent = `of course its 10 just like you my bbg`;
            createConfetti();
        } else if (guess < secretNumber) {
            messageEl.textContent = "Too low! Guess a little higher.";
        } else {
            messageEl.textContent = "Too high! Guess a little lower.";
        }
    }

    /*
      ============================
      SOUND EFFECTS
      ============================
    */
    let audioContext;
    let whooshSynth;
    let chimeSynth;
    let musicInitialized = false;

    async function initAudio() {
        if (!musicInitialized) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            whooshSynth = new Tone.Synth({ oscillator: { type: "triangle" }, envelope: { attack: 0.05, decay: 0.1, sustain: 0, release: 0.2 } }).toDestination();
            chimeSynth = new Tone.Synth({ oscillator: { type: "sine" }, envelope: { attack: 0.01, decay: 0.1, sustain: 0, release: 0.3 } }).toDestination();
            musicInitialized = true;
        }
    }
    function playWhooshSound() { initAudio(); whooshSynth.triggerAttackRelease("G4", "8n"); }
    function playChimeSound() { initAudio(); chimeSynth.triggerAttackRelease("C5", "8n"); }
  </script>

  <!-- Firebase setup and module script -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, onSnapshot, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
    
    setLogLevel('debug');
    
    // Firebase global variables
    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
    const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
    const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

    let db;
    let auth;
    let userId;
    let diaryCollectionRef;

    try {
      const app = initializeApp(firebaseConfig);
      db = getFirestore(app);
      auth = getAuth(app);
      
      (async () => {
        if (initialAuthToken) {
          await signInWithCustomToken(auth, initialAuthToken);
        } else {
          await signInAnonymously(auth);
        }
        userId = auth.currentUser?.uid || 'anonymous';
        
        const basePublicPath = `/artifacts/${appId}/public/data`;
        diaryCollectionRef = collection(db, `${basePublicPath}/bansi_diary`);

        // Listen for real-time updates to the diary
        onSnapshot(diaryCollectionRef, (snapshot) => {
            const diaryListElement = document.getElementById('diary-list');
            diaryListElement.innerHTML = '<h3 class="text-lg font-semibold text-pink-600 mb-2">Our Special Moments:</h3>';
            if (snapshot.empty) {
                diaryListElement.innerHTML += '<p class="text-gray-500 text-center">No entries saved yet. Add one!</p>';
            }
            snapshot.forEach(doc => {
                const entry = doc.data();
                const entryItem = document.createElement('div');
                entryItem.classList.add('bg-white', 'p-3', 'rounded-xl', 'border', 'border-pink-200', 'shadow-sm');
                entryItem.textContent = entry.entry;
                diaryListElement.appendChild(entryItem);
            });
        });
      })();
    } catch (e) {
      console.error("Firebase initialization failed:", e);
    }
    
    /*
      ============================
      VIRTUAL DIARY (FIXED)
      ============================
    */
    // This function is now inside the module, so it can access 'diaryCollectionRef'
    async function saveDiaryEntry() {
      const diaryInput = document.getElementById('diary-input');
      const newEntry = diaryInput.value.trim();
      if (newEntry && diaryCollectionRef) { // Now it knows what diaryCollectionRef is
        try {
            await addDoc(diaryCollectionRef, { 
                entry: newEntry,
                timestamp: new Date()
            });
            diaryInput.value = ''; // Clear the input after saving
        } catch (e) {
            console.error("Error saving diary entry: ", e);
        }
      } else {
          console.error("Diary entry is empty or database is not ready.");
      }
    }
    
    // We attach it to the global 'window' object so the HTML onclick="saveDiaryEntry()" can find it.
    window.saveDiaryEntry = saveDiaryEntry;
  </script>

</body>
</html>